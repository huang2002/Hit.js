if(!("OC"in window))throw new Error("Please load OC.js first!");Extension.export("Game-Scene",new Constructor(function(){this._agency=new Agency,this._agency.bind(this),this.items=[],this.bg=null,this.fps=null},{add:function(t){return this.items.push(t),this},remove:function(t){return this.items=Loop.filter(this.items,function(i){return i!==t}),this}})),Extension.export("Game-Controller",new Constructor(function(t){if(!t)return null;this.frame=new Ani.Frame,this.scene=null;var i=this;this.frame.listen("update",function(){if(i.scene){var e=t.context,n=t.UI,h=i.scene;h.fps>0&&(i.frame.fps=h.fps),h.bg&&(e.save(),e.fillStyle=h.bg,e.fillRect(0,0,n.width,n.height),e.restore()),h._agency.trigger("update"),Loop.each(h.items,function(t){"draw"in t&&t.draw(e)})}}),this.listenType=function(e){window.listen(e,function(n){var h="touches"in n?n.touches[0]:n,o=t.UI.toGameX(h.clientX),s=t.UI.toGameY(h.clientY),r=i.scene;r._agency.trigger(e,[n]),Loop.each(r.items,function(t){"_agency"in t&&"isPointInPath"in t&&t.isPointInPath(o,s)&&t._agency.trigger(e,[n])})})},this.listenType("click")},{start:function(t){return this.scene&&this.scene._agency.trigger("exit"),this.scene=t,this.scene._agency.trigger("enter"),this.frame.start(),this},stop:function(){return this.frame.stop(),this}})),Extension.export("Game-UI",new Constructor(function(t){this.width=960,this.height=640,this.padding=5,Object.defineProperties(this,{left:{value:0},top:{value:0},right:{get:function(){return this.width}},bottom:{get:function(){return this.height}},cx:{get:function(){return this.width/2}},cy:{get:function(){return this.height/2}}});var i=t._canvas;this.toGameX=function(t){var e=i.getBoundingClientRect();return(t-e.left)/e.width*this.width},this.toGameY=function(t){var e=i.getBoundingClientRect();return(t-e.top)/e.height*this.height}},{toGamePos:function(t){return{x:this.toGameX(t.x),y:this.toGameY(t.y)}}})),Extension.define("Game",["Game-Controller","Game-UI"],function(t,i){var e=new Constructor(function(){this._canvas=DOM.create("canvas.game"),this.context=this._canvas.getContext("2d"),this.controller=new t(this),this.UI=new i(this)},{init:function(t){try{t=t||{},t.width>0&&(this.UI.width=t.width),t.height>0&&(this.UI.height=t.height),t.padding>0&&(this.UI.padding=t.padding),"method"in t||(t.method=e.FIXED),document.body.css("margin","0"),document.body.css("padding","0"),document.body.css("overflow","hidden");var i=this._canvas,n=window.devicePixelRatio||1,h=function(){var e=t.method(this.UI);i.width=this.UI.width*window.devicePixelRatio,i.height=this.UI.height*window.devicePixelRatio,i.css("margin-left",e.left+"px"),i.css("margin-top",e.top+"px"),i.css("width",e.width+"px"),i.css("height",e.height+"px")}.bind(this);h(),t.autoResize!==!1&&(window.listen("resize",h),window.listen("orientationchange",h)),this.context.scale(n,n),document.body.appendChild(i)}catch(t){return console.error(t),!1}return!0}});return Loop.each({FIXED:function(t){var i=window.innerWidth,e=window.innerHeight,n=t.width,h=t.height,o=t.padding,s={},r=null;return i/e>n/h?(s.height=e-2*o,s.top=o,r=s.height/h,s.width=n*r,s.left=i/2-s.width/2):(s.width=i-2*o,s.left=o,r=s.width/n,s.height=h*r,s.top=e/2-s.height/2),s},FIXED_HEIGHT:function(t){var i=window.innerWidth,e=window.innerHeight,n=t.height,h=t.padding,o={},s=null;return o.height=e-2*h,o.top=h,s=o.height/n,o.width=i-2*h,t.width=o.width/s,o.left=h,o},FIXED_WIDTH:function(t){var i=window.innerWidth,e=window.innerHeight,n=t.width,h=t.padding,o={},s=null;return o.width=i-2*h,o.left=h,s=o.width/n,o.height=e-2*h,t.height=o.height/s,o.top=h,o},MIN:function(t){return{width:t.width,height:t.height,left:window.innerWidth/2-t.width/2,top:window.innerHeight/2-t.height/2}},MAX:function(t){return t.width=window.innerWidth-2*t.padding,t.height=window.innerHeight-2*t.padding,{left:t.padding,top:t.padding,width:t.width,height:t.height}}},function(t,i){e[i]=t}),e}),Extension.export("Vector",new Constructor(function(t,i){this.x=t,this.y=i,arguments.length>=2&&this.set(t,i)},{setVec:function(t){return this.set(t.x,t.y)},set:function(t,i){return"number"==typeof t&&(this.x=t),"number"==typeof i&&(this.y=i),this},add:function(t,i){return"number"==typeof t&&(this.x+=t),"number"==typeof i&&(this.y+=i),this},addVec:function(t){return this.add(t.x,t.y)},getSize:function(){return Math.distance(0,0,this.x,this.y)},setSize:function(t){var i=t/this.getSize();return this.x*=i,this.y*=i,this}}));