Extension.define("Menu",[],function(){"use strict";function e(e){e.listen("contextmenu",function(e){e.preventDefault()},{passive:!1})}function t(){o.css("width",i.innerWidth+"px"),o.css("height",i.innerHeight+"px")}var n,i=window,s=i.DOM,h=new Constructor(function(t){var n="div";"string"==typeof t&&(n+="#"+t),n+=".menu",this.ele=s.create(n).hide(),e(this.ele),this.items=[];o.appendChild(this.ele)},{add:function(e,t){var n=new l(e,t);return this.items.push(n),this.ele.appendChild(n.ele),this},delIndex:function(e){var t=this.items,n=t[e];return n&&(t.delIndex(e),this.ele.removeChild(n.ele)),this},show:function(e,t){n=this;var s=this.ele;s.show(),o.show(),s.css("left",e+"px"),s.css("top",t+"px");var h=s.getBoundingClientRect();return h.right+h.with+10>=i.innerWidth?s.addClass("left"):s.delClass("left"),h.bottom+h.height+10>=i.innerHeight?s.addClass("top"):s.delClass("top"),this},hide:function(){return this.ele.hide(),n=null,this},bind:function(t){var n=this;return t.on("hold",function(e,t,i){n.show(t,i)}),t.listen("mouseup",function(e){e.which<3||(e.preventDefault(),n.show(e.clientX,e.clientY))},{passive:!1}),e(t),this}}),o=h.layer=s.create("div#menu-layer");e(o),o.listen("mouseup",function(){n&&n.hide(),setImmediate(function(){o.hide()})}),i.listen("resize",t),s.ready(function(){t(),i.document.body.appendChild(o)});var l=h.Item=new Constructor(function(t,n){var i="button.menu-item";this.ele=s.create(i).listen("mousedown",function(e){e.which>1||Loop.each(h,function(t){t(e)})}),e(this.ele);var h=this.callbacks=[];"string"==typeof t&&this.setText(t),n&&this.addCallback(n)},{setText:function(e){return this.ele.innerHTML=e,this},addCallback:function(e){return this.callbacks.push(e),this}});return h});